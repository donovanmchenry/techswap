<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle || 'TechSwap' %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <%- include('partials/navbar') %>

    <main>
        <section class="cart-section">
            <div class="container">
                <h1>Shopping Cart</h1>

                <% if (cartItems.length === 0) { %>
                    <div class="empty-cart">
                        <div class="empty-cart-icon">üõí</div>
                        <h2>Your cart is empty</h2>
                        <p>Browse our products and add items to your cart</p>
                        <a href="/shop" class="btn btn-primary btn-lg">Start Shopping</a>
                    </div>
                <% } else { %>
                    <div class="cart-layout">
                        <div class="cart-items">
                            <% cartItems.forEach(item => { %>
                                <div class="cart-item">
                                    <img src="<%= item.image_url %>" alt="<%= item.title %>" class="cart-item-image" onerror="this.src='/images/placeholder.jpg'">
                                    <div class="cart-item-details">
                                        <h3><a href="/product/<%= item.id %>"><%= item.title %></a></h3>
                                        <p class="item-condition">Condition: <%= item.condition %></p>
                                        <p class="item-campus">üìç <%= item.campus %></p>
                                    </div>
                                    <div class="cart-item-quantity">
                                        <label>Quantity:</label>
                                        <div class="quantity-controls">
                                            <button onclick="updateQuantity(<%= item.id %>, <%= item.quantity - 1 %>)">-</button>
                                            <input type="number" value="<%= item.quantity %>" min="1" max="<%= item.stock %>" onchange="updateQuantity(<%= item.id %>, this.value)">
                                            <button onclick="updateQuantity(<%= item.id %>, <%= item.quantity + 1 %>)">+</button>
                                        </div>
                                    </div>
                                    <div class="cart-item-price">
                                        <div class="item-price">$<%= item.price.toFixed(2) %></div>
                                        <div class="item-subtotal">Subtotal: $<%= item.subtotal.toFixed(2) %></div>
                                    </div>
                                    <button class="cart-item-remove" onclick="removeFromCart(<%= item.id %>)">üóëÔ∏è</button>
                                </div>
                            <% }); %>
                        </div>

                        <div class="cart-summary">
                            <h2>Order Summary</h2>
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span>$<%= subtotal %></span>
                            </div>
                            <div class="summary-row">
                                <span>TechSwap Fee (8%):</span>
                                <span>$<%= commission %></span>
                            </div>
                            <div class="summary-row">
                                <span>Shipping:</span>
                                <span>Calculated at checkout</span>
                            </div>
                            <hr>
                            <div class="summary-row summary-total">
                                <span>Total:</span>
                                <span>$<%= total %></span>
                            </div>
                            <a href="/checkout" class="btn btn-primary btn-lg btn-block">Proceed to Checkout</a>
                            <a href="/shop" class="btn btn-outline btn-block">Continue Shopping</a>
                        </div>
                    </div>
                <% } %>
            </div>
        </section>
    </main>

    <%- include('partials/footer') %>

    <script src="/js/main.js"></script>
</body>
</html>
